language: php

matrix:
  fast_finish: true
  include:
    - php: '7.1'
    - php: '7.2'
      env: PHP_CODE_SNIFF=1
    - php: '7.4'
    - php: '8.0'
    - php: '8.1'

before_install:
  - if [[ "$PHP_CODE_SNIFF" == "1" ]]; then composer self-update; fi
  - if [[ "$PHP_CODE_SNIFF" == "1" ]]; then composer install; fi
  - if [[ "$PHP_CODE_SNIFF" == "1" ]]; then git clone -b master https://github.com/WordPress/WordPress-Coding-Standards.git /tmp/WordPress-Coding-Standards; fi
  - if [[ "$PHP_CODE_SNIFF" == "1" ]]; then ./vendor/bin/phpcs --config-set installed_paths /tmp/WordPress-Coding-Standards; fi

script:
  - find -L . -path ./vendor -prune -o -name '*.php' -print0 | xargs -0 -n 1 -P 4 php -l
  - if [[ "$PHP_CODE_SNIFF" == "1" ]]; then composer cs; fi

before_deploy:
  - bash ./scripts/build.sh

deploy:
  provider: releases
  api_key:
    secure: A/ZbZIXJnA3QGay9ZlG92UX3/CXZM5gcqyV7mIzHZf3uGVUflU+cZPVtt8JfUpEoU/d8iN0V9g7+hmKQHfYXJMYyA6G7QyUZrXK83Eq0kPGi5cl2Yexn3qZqzL1JhPAC9qyetiC4IsCFsSm3lbC8OT+8+laLA/Cccqt2/qYARxxk4lddu3sw3oB/PUWv6iPNPulXqoTzAQ2ZRZWzebask902GJ7v27WoGvsIBaxuqd0EW2eCdNjLMPQxt2knw0PF+quGgxXfJ944MJNMeXpKE4fo7qpWwxgMUHUTWfQnVUvRVLfpcCTboaAnbnILFXvWmz/Q+57Wi6MPNZLR5mmSQ+WE6aLjb7g+dxJxxWwev0fPrJlyraoA3jWrwvt00rI4D82SK2NHKnzQYTouEa8zIjr2IhQ/VpLFwPV8yRMPmg1TJIG/xLdHpJ6DbNANUsCGr3YpDqtNp7Amhsi+6DytloZsxAmRZP7xE6VtLxWnTjZYQ/g8rnl1Pvv4nDDmnhizifMjvOC4wOVw40/AinA9Ap2+DgDtLy4p3Z/q71ipj8Q7ImdS3bwPTn5C2z/9ygD9uheujRe0ZuNjTqB64tCTvQMf+cdjbTRK5NPlKWJpcpBYJ0XDYLvseuZdbSgiD8lC5JpzvKKTc+0Y6sb2xSWZVlPzWHJGaKUUHqzOliNNC0M=
  file: "./dist/pay-by-paynow-pl.zip"
  skip_cleanup: true
  on:
    repo: pay-now/paynow-woocommerce
    branch: master
    tags: true

after_deploy:
  - bash ./scripts/deploy_to_wp_svn.sh